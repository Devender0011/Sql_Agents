[
  {
    "timestamp_utc": "2025-12-08T07:07:58.844567",
    "question": "top 10 customer from customer table",
    "is_complex": false,
    "validated_sql": "SELECT TOP (10) customer_id, full_name, age, gender, email, phone, street_address, city, state, zip_code, registration_date, preferred_channel FROM customers ORDER BY customer_id ASC;",
    "generated_sql": "SELECT TOP (10) customer_id, full_name, age, gender, email, phone, street_address, city, state, zip_code, registration_date, preferred_channel FROM customers ORDER BY customer_id ASC;"
  },
  {
    "timestamp_utc": "2026-01-03T19:30:14.415665",
    "question": "For each marketing campaign, compare the average customer transaction amount during the campaign period with the average transaction amount 30 days before the campaign started. Also list how many customer support tickets were opened during the campaign window, how many customer reviews were posted (positive vs negative), and identify whether customer interactions increased or decreased during the campaign compared to the prior 30-day period.gave me top 5 rows only \r\n",
    "is_complex": false,
    "validated_sql": "WITH CampaignTransactionStats AS (\n    SELECT\n        c.campaign_id,\n        AVG(CASE WHEN t.transaction_date >= c.start_date AND t.transaction_date <= c.end_date THEN t.price END) AS AvgTransactionDuringCampaign,\n        AVG(CASE WHEN t.transaction_date >= DATEADD(DAY, -30, c.start_date) AND t.transaction_date < c.start_date THEN t.price END) AS AvgTransaction30DaysBeforeCampaign\n    FROM campaigns c\n    LEFT JOIN transactions_clean t ON t.transaction_date BETWEEN DATEADD(DAY, -30, c.start_date) AND c.end_date\n    GROUP BY c.campaign_id, c.start_date, c.end_date\n),\nCampaignSupportStats AS (\n    SELECT\n        c.campaign_id,\n        COUNT(st.ticket_id) AS TicketsOpenedDuringCampaign\n    FROM campaigns c\n    LEFT JOIN support_tickets_clean st ON st.submission_date >= c.start_date AND st.submission_date <= c.end_date\n    GROUP BY c.campaign_id\n),\nCampaignReviewStats AS (\n    SELECT\n        c.campaign_id,\n        SUM(CASE WHEN r.sentiment = 'Positive' THEN 1 ELSE 0 END) AS PositiveReviewsDuringCampaign,\n        SUM(CASE WHEN r.sentiment = 'Negative' THEN 1 ELSE 0 END) AS NegativeReviewsDuringCampaign\n    FROM campaigns c\n    LEFT JOIN reviews_clean r ON r.review_date >= c.start_date AND r.review_date <= c.end_date\n    GROUP BY c.campaign_id\n),\nCampaignInteractionStats AS (\n    SELECT\n        c.campaign_id,\n        COUNT(CASE WHEN i.interaction_date >= c.start_date AND i.interaction_date <= c.end_date THEN i.interaction_id END) AS InteractionsDuringCampaign,\n        COUNT(CASE WHEN i.interaction_date >= DATEADD(DAY, -30, c.start_date) AND i.interaction_date < c.start_date THEN i.interaction_id END) AS InteractionsPreCampaign\n    FROM campaigns c\n    LEFT JOIN interactions_clean i ON i.interaction_date BETWEEN DATEADD(DAY, -30, c.start_date) AND c.end_date\n    GROUP BY c.campaign_id, c.start_date\n)\nSELECT TOP 5\n    c.campaign_name,\n    c.start_date,\n    c.end_date,\n    ISNULL(cts.AvgTransactionDuringCampaign, 0.0) AS AvgTransactionDuringCampaign,\n    ISNULL(cts.AvgTransaction30DaysBeforeCampaign, 0.0) AS AvgTransaction30DaysBeforeCampaign,\n    ISNULL(css.TicketsOpenedDuringCampaign, 0) AS SupportTicketsDuringCampaign,\n    ISNULL(crs.PositiveReviewsDuringCampaign, 0) AS PositiveReviewsDuringCampaign,\n    ISNULL(crs.NegativeReviewsDuringCampaign, 0) AS NegativeReviewsDuringCampaign,\n    ISNULL(cis.InteractionsDuringCampaign, 0) AS TotalInteractionsDuringCampaign,\n    ISNULL(cis.InteractionsPreCampaign, 0) AS TotalInteractions30DaysBeforeCampaign,\n    CASE\n        WHEN ISNULL(cis.InteractionsDuringCampaign, 0) > ISNULL(cis.InteractionsPreCampaign, 0) THEN 'Increased'\n        WHEN ISNULL(cis.InteractionsDuringCampaign, 0) < ISNULL(cis.InteractionsPreCampaign, 0) THEN 'Decreased'\n        ELSE 'No Change'\n    END AS InteractionChange\nFROM campaigns c\nLEFT JOIN CampaignTransactionStats cts ON c.campaign_id = cts.campaign_id\nLEFT JOIN CampaignSupportStats css ON c.campaign_id = css.campaign_id\nLEFT JOIN CampaignReviewStats crs ON c.campaign_id = crs.campaign_id\nLEFT JOIN CampaignInteractionStats cis ON c.campaign_id = cis.campaign_id\nORDER BY c.start_date;",
    "generated_sql": "WITH CampaignTransactionStats AS (\n    SELECT\n        c.campaign_id,\n        AVG(CASE WHEN t.transaction_date >= c.start_date AND t.transaction_date <= c.end_date THEN t.price END) AS AvgTransactionDuringCampaign,\n        AVG(CASE WHEN t.transaction_date >= DATEADD(DAY, -30, c.start_date) AND t.transaction_date < c.start_date THEN t.price END) AS AvgTransaction30DaysBeforeCampaign\n    FROM campaigns c\n    LEFT JOIN transactions_clean t ON t.transaction_date BETWEEN DATEADD(DAY, -30, c.start_date) AND c.end_date\n    GROUP BY c.campaign_id, c.start_date, c.end_date\n),\nCampaignSupportStats AS (\n    SELECT\n        c.campaign_id,\n        COUNT(st.ticket_id) AS TicketsOpenedDuringCampaign\n    FROM campaigns c\n    LEFT JOIN support_tickets_clean st ON st.submission_date >= c.start_date AND st.submission_date <= c.end_date\n    GROUP BY c.campaign_id\n),\nCampaignReviewStats AS (\n    SELECT\n        c.campaign_id,\n        SUM(CASE WHEN r.sentiment = 'Positive' THEN 1 ELSE 0 END) AS PositiveReviewsDuringCampaign,\n        SUM(CASE WHEN r.sentiment = 'Negative' THEN 1 ELSE 0 END) AS NegativeReviewsDuringCampaign\n    FROM campaigns c\n    LEFT JOIN reviews_clean r ON r.review_date >= c.start_date AND r.review_date <= c.end_date\n    GROUP BY c.campaign_id\n),\nCampaignInteractionStats AS (\n    SELECT\n        c.campaign_id,\n        COUNT(CASE WHEN i.interaction_date >= c.start_date AND i.interaction_date <= c.end_date THEN i.interaction_id END) AS InteractionsDuringCampaign,\n        COUNT(CASE WHEN i.interaction_date >= DATEADD(DAY, -30, c.start_date) AND i.interaction_date < c.start_date THEN i.interaction_id END) AS InteractionsPreCampaign\n    FROM campaigns c\n    LEFT JOIN interactions_clean i ON i.interaction_date BETWEEN DATEADD(DAY, -30, c.start_date) AND c.end_date\n    GROUP BY c.campaign_id, c.start_date\n)\nSELECT TOP 5\n    c.campaign_name,\n    c.start_date,\n    c.end_date,\n    ISNULL(cts.AvgTransactionDuringCampaign, 0.0) AS AvgTransactionDuringCampaign,\n    ISNULL(cts.AvgTransaction30DaysBeforeCampaign, 0.0) AS AvgTransaction30DaysBeforeCampaign,\n    ISNULL(css.TicketsOpenedDuringCampaign, 0) AS SupportTicketsDuringCampaign,\n    ISNULL(crs.PositiveReviewsDuringCampaign, 0) AS PositiveReviewsDuringCampaign,\n    ISNULL(crs.NegativeReviewsDuringCampaign, 0) AS NegativeReviewsDuringCampaign,\n    ISNULL(cis.InteractionsDuringCampaign, 0) AS TotalInteractionsDuringCampaign,\n    ISNULL(cis.InteractionsPreCampaign, 0) AS TotalInteractions30DaysBeforeCampaign,\n    CASE\n        WHEN ISNULL(cis.InteractionsDuringCampaign, 0) > ISNULL(cis.InteractionsPreCampaign, 0) THEN 'Increased'\n        WHEN ISNULL(cis.InteractionsDuringCampaign, 0) < ISNULL(cis.InteractionsPreCampaign, 0) THEN 'Decreased'\n        ELSE 'No Change'\n    END AS InteractionChange\nFROM campaigns c\nLEFT JOIN CampaignTransactionStats cts ON c.campaign_id = cts.campaign_id\nLEFT JOIN CampaignSupportStats css ON c.campaign_id = css.campaign_id\nLEFT JOIN CampaignReviewStats crs ON c.campaign_id = crs.campaign_id\nLEFT JOIN CampaignInteractionStats cis ON c.campaign_id = cis.campaign_id\nORDER BY c.start_date;"
  },
  {
    "timestamp_utc": "2026-01-05T06:14:28.116021",
    "question": "1. For each marketing campaign, compare the average customer transaction amount during the campaign period with the average transaction amount 30 days before the campaign started. Also list how many customer support tickets were opened during the campaign window, how many customer reviews were posted (positive vs negative), and identify whether customer interactions increased or decreased during the campaign compared to the prior 30-day period.gave me top 5 rows only",
    "is_complex": false,
    "validated_sql": "WITH CampaignAvgTransactions AS (\n    SELECT\n        c.campaign_id,\n        AVG(CASE WHEN t.transaction_date >= c.start_date AND t.transaction_date <= c.end_date THEN t.quantity * t.price ELSE NULL END) AS AvgTransAmountDuringCampaign,\n        AVG(CASE WHEN t.transaction_date >= DATEADD(DAY, -30, c.start_date) AND t.transaction_date < c.start_date THEN t.quantity * t.price ELSE NULL END) AS AvgTransAmountPreCampaign\n    FROM campaigns AS c\n    LEFT JOIN transactions AS t ON t.transaction_date BETWEEN DATEADD(DAY, -30, c.start_date) AND c.end_date\n    GROUP BY c.campaign_id\n),\nCampaignSupportTickets AS (\n    SELECT\n        c.campaign_id,\n        COUNT(st.ticket_id) AS SupportTicketsDuringCampaign\n    FROM campaigns AS c\n    LEFT JOIN support_tickets AS st ON st.submission_date >= c.start_date AND st.submission_date <= c.end_date\n    GROUP BY c.campaign_id\n),\nCampaignReviews AS (\n    SELECT\n        c.campaign_id,\n        SUM(CASE WHEN rc.sentiment = 'Positive' THEN 1 ELSE 0 END) AS PositiveReviewsDuringCampaign,\n        SUM(CASE WHEN rc.sentiment = 'Negative' THEN 1 ELSE 0 END) AS NegativeReviewsDuringCampaign\n    FROM campaigns AS c\n    LEFT JOIN reviews_clean AS rc ON rc.review_date >= c.start_date AND rc.review_date <= c.end_date\n    GROUP BY c.campaign_id\n),\nCampaignInteractions AS (\n    SELECT\n        c.campaign_id,\n        COUNT(CASE WHEN i.interaction_date >= c.start_date AND i.interaction_date <= c.end_date THEN i.interaction_id ELSE NULL END) AS InteractionsDuringCampaign,\n        COUNT(CASE WHEN i.interaction_date >= DATEADD(DAY, -30, c.start_date) AND i.interaction_date < c.start_date THEN i.interaction_id ELSE NULL END) AS InteractionsPreCampaign\n    FROM campaigns AS c\n    LEFT JOIN interactions AS i ON i.interaction_date BETWEEN DATEADD(DAY, -30, c.start_date) AND c.end_date\n    GROUP BY c.campaign_id\n)\nSELECT TOP (5)\n    c.campaign_name,\n    c.start_date,\n    c.end_date,\n    ISNULL(cat.AvgTransAmountDuringCampaign, 0.0) AS AvgTransactionAmountDuringCampaign,\n    ISNULL(cat.AvgTransAmountPreCampaign, 0.0) AS AvgTransactionAmountPreCampaign,\n    ISNULL(cst.SupportTicketsDuringCampaign, 0) AS SupportTicketsOpenedDuringCampaign,\n    ISNULL(cr.PositiveReviewsDuringCampaign, 0) AS PositiveReviewsDuringCampaign,\n    ISNULL(cr.NegativeReviewsDuringCampaign, 0) AS NegativeReviewsDuringCampaign,\n    CASE\n        WHEN ci.InteractionsDuringCampaign > ci.InteractionsPreCampaign THEN 'Increased'\n        WHEN ci.InteractionsDuringCampaign < ci.InteractionsPreCampaign THEN 'Decreased'\n        ELSE 'Same'\n    END AS InteractionTrend\nFROM campaigns AS c\nLEFT JOIN CampaignAvgTransactions AS cat ON c.campaign_id = cat.campaign_id\nLEFT JOIN CampaignSupportTickets AS cst ON c.campaign_id = cst.campaign_id\nLEFT JOIN CampaignReviews AS cr ON c.campaign_id = cr.campaign_id\nLEFT JOIN CampaignInteractions AS ci ON c.campaign_id = ci.campaign_id\nORDER BY c.campaign_id;",
    "generated_sql": "WITH CampaignAvgTransactions AS (\n    SELECT\n        c.campaign_id,\n        AVG(CASE WHEN t.transaction_date >= c.start_date AND t.transaction_date <= c.end_date THEN t.quantity * t.price ELSE NULL END) AS AvgTransAmountDuringCampaign,\n        AVG(CASE WHEN t.transaction_date >= DATEADD(DAY, -30, c.start_date) AND t.transaction_date < c.start_date THEN t.quantity * t.price ELSE NULL END) AS AvgTransAmountPreCampaign\n    FROM campaigns AS c\n    LEFT JOIN transactions AS t ON t.transaction_date BETWEEN DATEADD(DAY, -30, c.start_date) AND c.end_date\n    GROUP BY c.campaign_id\n),\nCampaignSupportTickets AS (\n    SELECT\n        c.campaign_id,\n        COUNT(st.ticket_id) AS SupportTicketsDuringCampaign\n    FROM campaigns AS c\n    LEFT JOIN support_tickets AS st ON st.submission_date >= c.start_date AND st.submission_date <= c.end_date\n    GROUP BY c.campaign_id\n),\nCampaignReviews AS (\n    SELECT\n        c.campaign_id,\n        SUM(CASE WHEN rc.sentiment = 'Positive' THEN 1 ELSE 0 END) AS PositiveReviewsDuringCampaign,\n        SUM(CASE WHEN rc.sentiment = 'Negative' THEN 1 ELSE 0 END) AS NegativeReviewsDuringCampaign\n    FROM campaigns AS c\n    LEFT JOIN reviews_clean AS rc ON rc.review_date >= c.start_date AND rc.review_date <= c.end_date\n    GROUP BY c.campaign_id\n),\nCampaignInteractions AS (\n    SELECT\n        c.campaign_id,\n        COUNT(CASE WHEN i.interaction_date >= c.start_date AND i.interaction_date <= c.end_date THEN i.interaction_id ELSE NULL END) AS InteractionsDuringCampaign,\n        COUNT(CASE WHEN i.interaction_date >= DATEADD(DAY, -30, c.start_date) AND i.interaction_date < c.start_date THEN i.interaction_id ELSE NULL END) AS InteractionsPreCampaign\n    FROM campaigns AS c\n    LEFT JOIN interactions AS i ON i.interaction_date BETWEEN DATEADD(DAY, -30, c.start_date) AND c.end_date\n    GROUP BY c.campaign_id\n)\nSELECT TOP (5)\n    c.campaign_name,\n    c.start_date,\n    c.end_date,\n    ISNULL(cat.AvgTransAmountDuringCampaign, 0.0) AS AvgTransactionAmountDuringCampaign,\n    ISNULL(cat.AvgTransAmountPreCampaign, 0.0) AS AvgTransactionAmountPreCampaign,\n    ISNULL(cst.SupportTicketsDuringCampaign, 0) AS SupportTicketsOpenedDuringCampaign,\n    ISNULL(cr.PositiveReviewsDuringCampaign, 0) AS PositiveReviewsDuringCampaign,\n    ISNULL(cr.NegativeReviewsDuringCampaign, 0) AS NegativeReviewsDuringCampaign,\n    CASE\n        WHEN ci.InteractionsDuringCampaign > ci.InteractionsPreCampaign THEN 'Increased'\n        WHEN ci.InteractionsDuringCampaign < ci.InteractionsPreCampaign THEN 'Decreased'\n        ELSE 'Same'\n    END AS InteractionTrend\nFROM campaigns AS c\nLEFT JOIN CampaignAvgTransactions AS cat ON c.campaign_id = cat.campaign_id\nLEFT JOIN CampaignSupportTickets AS cst ON c.campaign_id = cst.campaign_id\nLEFT JOIN CampaignReviews AS cr ON c.campaign_id = cr.campaign_id\nLEFT JOIN CampaignInteractions AS ci ON c.campaign_id = ci.campaign_id\nORDER BY c.campaign_id;"
  },
  {
    "timestamp_utc": "2026-01-05T06:16:10.490121",
    "question": "1. For each marketing campaign, compare the average customer transaction amount during the campaign period with the average transaction amount 30 days before the campaign started. Also list how many customer support tickets were opened during the campaign window, how many customer reviews were posted (positive vs negative), and identify whether customer interactions increased or decreased during the campaign compared to the prior 30-day period.gave me top 5 rows only",
    "is_complex": false,
    "validated_sql": "WITH CampaignDetails AS (\n    SELECT\n        c.campaign_id,\n        c.campaign_name,\n        c.start_date,\n        c.end_date,\n        DATEADD(day, -30, c.start_date) AS pre_campaign_start_date,\n        DATEADD(day, -1, c.start_date) AS pre_campaign_end_date\n    FROM campaigns AS c\n),\nCampaignCustomerSpends AS (\n    SELECT\n        cd.campaign_id,\n        t.customer_id,\n        SUM(t.quantity * t.price) AS CustomerTotalSpend\n    FROM CampaignDetails AS cd\n    JOIN transactions AS t\n        ON t.transaction_date >= cd.start_date\n        AND t.transaction_date <= cd.end_date\n    GROUP BY cd.campaign_id, t.customer_id\n),\nCampaignTransactionAmounts AS (\n    SELECT\n        campaign_id,\n        AVG(CustomerTotalSpend) AS AvgTransactionAmountCampaign\n    FROM CampaignCustomerSpends\n    GROUP BY campaign_id\n),\nPreCampaignCustomerSpends AS (\n    SELECT\n        cd.campaign_id,\n        t.customer_id,\n        SUM(t.quantity * t.price) AS CustomerTotalSpend\n    FROM CampaignDetails AS cd\n    JOIN transactions AS t\n        ON t.transaction_date >= cd.pre_campaign_start_date\n        AND t.transaction_date <= cd.pre_campaign_end_date\n    GROUP BY cd.campaign_id, t.customer_id\n),\nPreCampaignTransactionAmounts AS (\n    SELECT\n        campaign_id,\n        AVG(CustomerTotalSpend) AS AvgTransactionAmountPreCampaign\n    FROM PreCampaignCustomerSpends\n    GROUP BY campaign_id\n),\nCampaignSupportTickets AS (\n    SELECT\n        cd.campaign_id,\n        COUNT(st.ticket_id) AS NumSupportTicketsCampaign\n    FROM CampaignDetails AS cd\n    LEFT JOIN support_tickets AS st\n        ON st.submission_date >= cd.start_date\n        AND st.submission_date <= cd.end_date\n    GROUP BY cd.campaign_id\n),\nCampaignReviews AS (\n    SELECT\n        cd.campaign_id,\n        SUM(CASE WHEN rc.sentiment = 'Positive' THEN 1 ELSE 0 END) AS NumPositiveReviewsCampaign,\n        SUM(CASE WHEN rc.sentiment = 'Negative' THEN 1 ELSE 0 END) AS NumNegativeReviewsCampaign\n    FROM CampaignDetails AS cd\n    LEFT JOIN reviews_clean AS rc\n        ON rc.review_date >= cd.start_date\n        AND rc.review_date <= cd.end_date\n    GROUP BY cd.campaign_id\n),\nCampaignInteractions AS (\n    SELECT\n        cd.campaign_id,\n        COUNT(i.interaction_id) AS NumInteractionsCampaign\n    FROM CampaignDetails AS cd\n    LEFT JOIN interactions AS i\n        ON i.interaction_date >= cd.start_date\n        AND i.interaction_date <= cd.end_date\n    GROUP BY cd.campaign_id\n),\nPreCampaignInteractions AS (\n    SELECT\n        cd.campaign_id,\n        COUNT(i.interaction_id) AS NumInteractionsPreCampaign\n    FROM CampaignDetails AS cd\n    LEFT JOIN interactions AS i\n        ON i.interaction_date >= cd.pre_campaign_start_date\n        AND i.interaction_date <= cd.pre_campaign_end_date\n    GROUP BY cd.campaign_id\n)\nSELECT TOP (5)\n    cd.campaign_id,\n    cd.campaign_name,\n    ISNULL(cta.AvgTransactionAmountCampaign, 0.0) AS AvgTransactionAmountCampaign,\n    ISNULL(pcta.AvgTransactionAmountPreCampaign, 0.0) AS AvgTransactionAmountPreCampaign,\n    ISNULL(cst.NumSupportTicketsCampaign, 0) AS NumSupportTicketsCampaign,\n    ISNULL(cr.NumPositiveReviewsCampaign, 0) AS NumPositiveReviewsCampaign,\n    ISNULL(cr.NumNegativeReviewsCampaign, 0) AS NumNegativeReviewsCampaign,\n    ISNULL(ci.NumInteractionsCampaign, 0) AS NumInteractionsCampaign,\n    ISNULL(pci.NumInteractionsPreCampaign, 0) AS NumInteractionsPreCampaign,\n    CASE\n        WHEN ISNULL(ci.NumInteractionsCampaign, 0) > ISNULL(pci.NumInteractionsPreCampaign, 0) THEN 'Increased'\n        WHEN ISNULL(ci.NumInteractionsCampaign, 0) < ISNULL(pci.NumInteractionsPreCampaign, 0) THEN 'Decreased'\n        ELSE 'No Change'\n    END AS InteractionChangeStatus\nFROM CampaignDetails AS cd\nLEFT JOIN CampaignTransactionAmounts AS cta\n    ON cd.campaign_id = cta.campaign_id\nLEFT JOIN PreCampaignTransactionAmounts AS pcta\n    ON cd.campaign_id = pcta.campaign_id\nLEFT JOIN CampaignSupportTickets AS cst\n    ON cd.campaign_id = cst.campaign_id\nLEFT JOIN CampaignReviews AS cr\n    ON cd.campaign_id = cr.campaign_id\nLEFT JOIN CampaignInteractions AS ci\n    ON cd.campaign_id = ci.campaign_id\nLEFT JOIN PreCampaignInteractions AS pci\n    ON cd.campaign_id = pci.campaign_id\nORDER BY cd.campaign_id;",
    "generated_sql": "WITH CampaignDetails AS (\n    SELECT\n        c.campaign_id,\n        c.campaign_name,\n        c.start_date,\n        c.end_date,\n        DATEADD(day, -30, c.start_date) AS pre_campaign_start_date,\n        DATEADD(day, -1, c.start_date) AS pre_campaign_end_date\n    FROM campaigns AS c\n),\nCampaignCustomerSpends AS (\n    SELECT\n        cd.campaign_id,\n        t.customer_id,\n        SUM(t.quantity * t.price) AS CustomerTotalSpend\n    FROM CampaignDetails AS cd\n    JOIN transactions AS t\n        ON t.transaction_date >= cd.start_date\n        AND t.transaction_date <= cd.end_date\n    GROUP BY cd.campaign_id, t.customer_id\n),\nCampaignTransactionAmounts AS (\n    SELECT\n        campaign_id,\n        AVG(CustomerTotalSpend) AS AvgTransactionAmountCampaign\n    FROM CampaignCustomerSpends\n    GROUP BY campaign_id\n),\nPreCampaignCustomerSpends AS (\n    SELECT\n        cd.campaign_id,\n        t.customer_id,\n        SUM(t.quantity * t.price) AS CustomerTotalSpend\n    FROM CampaignDetails AS cd\n    JOIN transactions AS t\n        ON t.transaction_date >= cd.pre_campaign_start_date\n        AND t.transaction_date <= cd.pre_campaign_end_date\n    GROUP BY cd.campaign_id, t.customer_id\n),\nPreCampaignTransactionAmounts AS (\n    SELECT\n        campaign_id,\n        AVG(CustomerTotalSpend) AS AvgTransactionAmountPreCampaign\n    FROM PreCampaignCustomerSpends\n    GROUP BY campaign_id\n),\nCampaignSupportTickets AS (\n    SELECT\n        cd.campaign_id,\n        COUNT(st.ticket_id) AS NumSupportTicketsCampaign\n    FROM CampaignDetails AS cd\n    LEFT JOIN support_tickets AS st\n        ON st.submission_date >= cd.start_date\n        AND st.submission_date <= cd.end_date\n    GROUP BY cd.campaign_id\n),\nCampaignReviews AS (\n    SELECT\n        cd.campaign_id,\n        SUM(CASE WHEN rc.sentiment = 'Positive' THEN 1 ELSE 0 END) AS NumPositiveReviewsCampaign,\n        SUM(CASE WHEN rc.sentiment = 'Negative' THEN 1 ELSE 0 END) AS NumNegativeReviewsCampaign\n    FROM CampaignDetails AS cd\n    LEFT JOIN reviews_clean AS rc\n        ON rc.review_date >= cd.start_date\n        AND rc.review_date <= cd.end_date\n    GROUP BY cd.campaign_id\n),\nCampaignInteractions AS (\n    SELECT\n        cd.campaign_id,\n        COUNT(i.interaction_id) AS NumInteractionsCampaign\n    FROM CampaignDetails AS cd\n    LEFT JOIN interactions AS i\n        ON i.interaction_date >= cd.start_date\n        AND i.interaction_date <= cd.end_date\n    GROUP BY cd.campaign_id\n),\nPreCampaignInteractions AS (\n    SELECT\n        cd.campaign_id,\n        COUNT(i.interaction_id) AS NumInteractionsPreCampaign\n    FROM CampaignDetails AS cd\n    LEFT JOIN interactions AS i\n        ON i.interaction_date >= cd.pre_campaign_start_date\n        AND i.interaction_date <= cd.pre_campaign_end_date\n    GROUP BY cd.campaign_id\n)\nSELECT TOP (5)\n    cd.campaign_id,\n    cd.campaign_name,\n    ISNULL(cta.AvgTransactionAmountCampaign, 0.0) AS AvgTransactionAmountCampaign,\n    ISNULL(pcta.AvgTransactionAmountPreCampaign, 0.0) AS AvgTransactionAmountPreCampaign,\n    ISNULL(cst.NumSupportTicketsCampaign, 0) AS NumSupportTicketsCampaign,\n    ISNULL(cr.NumPositiveReviewsCampaign, 0) AS NumPositiveReviewsCampaign,\n    ISNULL(cr.NumNegativeReviewsCampaign, 0) AS NumNegativeReviewsCampaign,\n    ISNULL(ci.NumInteractionsCampaign, 0) AS NumInteractionsCampaign,\n    ISNULL(pci.NumInteractionsPreCampaign, 0) AS NumInteractionsPreCampaign,\n    CASE\n        WHEN ISNULL(ci.NumInteractionsCampaign, 0) > ISNULL(pci.NumInteractionsPreCampaign, 0) THEN 'Increased'\n        WHEN ISNULL(ci.NumInteractionsCampaign, 0) < ISNULL(pci.NumInteractionsPreCampaign, 0) THEN 'Decreased'\n        ELSE 'No Change'\n    END AS InteractionChangeStatus\nFROM CampaignDetails AS cd\nLEFT JOIN CampaignTransactionAmounts AS cta\n    ON cd.campaign_id = cta.campaign_id\nLEFT JOIN PreCampaignTransactionAmounts AS pcta\n    ON cd.campaign_id = pcta.campaign_id\nLEFT JOIN CampaignSupportTickets AS cst\n    ON cd.campaign_id = cst.campaign_id\nLEFT JOIN CampaignReviews AS cr\n    ON cd.campaign_id = cr.campaign_id\nLEFT JOIN CampaignInteractions AS ci\n    ON cd.campaign_id = ci.campaign_id\nLEFT JOIN PreCampaignInteractions AS pci\n    ON cd.campaign_id = pci.campaign_id\nORDER BY cd.campaign_id;"
  },
  {
    "timestamp_utc": "2026-01-05T11:21:41.885178",
    "question": "For each marketing campaign, compare the average customer transaction amount during the campaign period with the average transaction amount 30 days before the campaign started. Also list how many customer support tickets were opened during the campaign window, how many customer reviews were posted (positive vs negative), and identify whether customer interactions increased or decreased during the campaign compared to the prior 30-day period.gave me top 5 rows only",
    "is_complex": false,
    "validated_sql": "WITH CampaignPeriods AS (\n    SELECT\n        c.campaign_id,\n        c.campaign_name,\n        c.start_date,\n        c.end_date,\n        DATEADD(DAY, -30, CAST(c.start_date AS DATE)) AS pre_campaign_start_date,\n        DATEADD(DAY, -1, CAST(c.start_date AS DATE)) AS pre_campaign_end_date\n    FROM\n        campaigns AS c\n),\nCampaignTransactionStats AS (\n    SELECT\n        cp.campaign_id,\n        AVG(CASE WHEN t.transaction_date >= cp.start_date AND t.transaction_date <= cp.end_date THEN t.price ELSE NULL END) AS avg_transaction_campaign,\n        AVG(CASE WHEN t.transaction_date >= cp.pre_campaign_start_date AND t.transaction_date <= cp.pre_campaign_end_date THEN t.price ELSE NULL END) AS avg_transaction_pre_campaign\n    FROM\n        CampaignPeriods AS cp\n    LEFT JOIN\n        transactions_clean AS t ON t.transaction_date >= cp.pre_campaign_start_date AND t.transaction_date <= cp.end_date\n    GROUP BY\n        cp.campaign_id\n),\nCampaignTicketCounts AS (\n    SELECT\n        cp.campaign_id,\n        COUNT(st.ticket_id) AS support_tickets_campaign\n    FROM\n        CampaignPeriods AS cp\n    LEFT JOIN\n        support_tickets_clean AS st ON st.submission_date >= cp.start_date AND st.submission_date <= cp.end_date\n    GROUP BY\n        cp.campaign_id\n),\nCampaignReviewCounts AS (\n    SELECT\n        cp.campaign_id,\n        COUNT(CASE WHEN r.sentiment = 'Positive' THEN r.review_id ELSE NULL END) AS positive_reviews_campaign,\n        COUNT(CASE WHEN r.sentiment = 'Negative' THEN r.review_id ELSE NULL END) AS negative_reviews_campaign\n    FROM\n        CampaignPeriods AS cp\n    LEFT JOIN\n        reviews_clean AS r ON r.review_date >= cp.start_date AND r.review_date <= cp.end_date\n    GROUP BY\n        cp.campaign_id\n),\nCampaignInteractionCounts AS (\n    SELECT\n        cp.campaign_id,\n        COUNT(CASE WHEN i.interaction_date >= cp.start_date AND i.interaction_date <= cp.end_date THEN i.interaction_id ELSE NULL END) AS interactions_campaign,\n        COUNT(CASE WHEN i.interaction_date >= cp.pre_campaign_start_date AND i.interaction_date <= cp.pre_campaign_end_date THEN i.interaction_id ELSE NULL END) AS interactions_pre_campaign\n    FROM\n        CampaignPeriods AS cp\n    LEFT JOIN\n        interactions_clean AS i ON i.interaction_date >= cp.pre_campaign_start_date AND i.interaction_date <= cp.end_date\n    GROUP BY\n        cp.campaign_id\n)\nSELECT TOP 5\n    cp.campaign_name,\n    cp.start_date,\n    cp.end_date,\n    ISNULL(cts.avg_transaction_campaign, 0.0) AS avg_transaction_campaign,\n    ISNULL(cts.avg_transaction_pre_campaign, 0.0) AS avg_transaction_pre_campaign,\n    ISNULL(ctc.support_tickets_campaign, 0) AS support_tickets_campaign,\n    ISNULL(crc.positive_reviews_campaign, 0) AS positive_reviews_campaign,\n    ISNULL(crc.negative_reviews_campaign, 0) AS negative_reviews_campaign,\n    ISNULL(cic.interactions_campaign, 0) AS interactions_campaign,\n    ISNULL(cic.interactions_pre_campaign, 0) AS interactions_pre_campaign,\n    CASE\n        WHEN ISNULL(cic.interactions_campaign, 0) > ISNULL(cic.interactions_pre_campaign, 0) THEN 'Increased'\n        WHEN ISNULL(cic.interactions_campaign, 0) < ISNULL(cic.interactions_pre_campaign, 0) THEN 'Decreased'\n        WHEN ISNULL(cic.interactions_campaign, 0) = ISNULL(cic.interactions_pre_campaign, 0) THEN 'No Change'\n        ELSE 'N/A' -- Fallback, though with ISNULL, this path should ideally not be reached\n    END AS interaction_trend\nFROM\n    CampaignPeriods AS cp\nLEFT JOIN\n    CampaignTransactionStats AS cts ON cp.campaign_id = cts.campaign_id\nLEFT JOIN\n    CampaignTicketCounts AS ctc ON cp.campaign_id = ctc.campaign_id\nLEFT JOIN\n    CampaignReviewCounts AS crc ON cp.campaign_id = crc.campaign_id\nLEFT JOIN\n    CampaignInteractionCounts AS cic ON cp.campaign_id = cic.campaign_id\nORDER BY\n    cp.start_date;",
    "generated_sql": "WITH CampaignPeriods AS (\n    SELECT\n        c.campaign_id,\n        c.campaign_name,\n        c.start_date,\n        c.end_date,\n        DATEADD(DAY, -30, CAST(c.start_date AS DATE)) AS pre_campaign_start_date,\n        DATEADD(DAY, -1, CAST(c.start_date AS DATE)) AS pre_campaign_end_date\n    FROM\n        campaigns AS c\n),\nCampaignTransactionStats AS (\n    SELECT\n        cp.campaign_id,\n        AVG(CASE WHEN t.transaction_date >= cp.start_date AND t.transaction_date <= cp.end_date THEN t.price ELSE NULL END) AS avg_transaction_campaign,\n        AVG(CASE WHEN t.transaction_date >= cp.pre_campaign_start_date AND t.transaction_date <= cp.pre_campaign_end_date THEN t.price ELSE NULL END) AS avg_transaction_pre_campaign\n    FROM\n        CampaignPeriods AS cp\n    LEFT JOIN\n        transactions_clean AS t ON t.transaction_date >= cp.pre_campaign_start_date AND t.transaction_date <= cp.end_date\n    GROUP BY\n        cp.campaign_id\n),\nCampaignTicketCounts AS (\n    SELECT\n        cp.campaign_id,\n        COUNT(st.ticket_id) AS support_tickets_campaign\n    FROM\n        CampaignPeriods AS cp\n    LEFT JOIN\n        support_tickets_clean AS st ON st.submission_date >= cp.start_date AND st.submission_date <= cp.end_date\n    GROUP BY\n        cp.campaign_id\n),\nCampaignReviewCounts AS (\n    SELECT\n        cp.campaign_id,\n        COUNT(CASE WHEN r.sentiment = 'Positive' THEN r.review_id ELSE NULL END) AS positive_reviews_campaign,\n        COUNT(CASE WHEN r.sentiment = 'Negative' THEN r.review_id ELSE NULL END) AS negative_reviews_campaign\n    FROM\n        CampaignPeriods AS cp\n    LEFT JOIN\n        reviews_clean AS r ON r.review_date >= cp.start_date AND r.review_date <= cp.end_date\n    GROUP BY\n        cp.campaign_id\n),\nCampaignInteractionCounts AS (\n    SELECT\n        cp.campaign_id,\n        COUNT(CASE WHEN i.interaction_date >= cp.start_date AND i.interaction_date <= cp.end_date THEN i.interaction_id ELSE NULL END) AS interactions_campaign,\n        COUNT(CASE WHEN i.interaction_date >= cp.pre_campaign_start_date AND i.interaction_date <= cp.pre_campaign_end_date THEN i.interaction_id ELSE NULL END) AS interactions_pre_campaign\n    FROM\n        CampaignPeriods AS cp\n    LEFT JOIN\n        interactions_clean AS i ON i.interaction_date >= cp.pre_campaign_start_date AND i.interaction_date <= cp.end_date\n    GROUP BY\n        cp.campaign_id\n)\nSELECT TOP 5\n    cp.campaign_name,\n    cp.start_date,\n    cp.end_date,\n    ISNULL(cts.avg_transaction_campaign, 0.0) AS avg_transaction_campaign,\n    ISNULL(cts.avg_transaction_pre_campaign, 0.0) AS avg_transaction_pre_campaign,\n    ISNULL(ctc.support_tickets_campaign, 0) AS support_tickets_campaign,\n    ISNULL(crc.positive_reviews_campaign, 0) AS positive_reviews_campaign,\n    ISNULL(crc.negative_reviews_campaign, 0) AS negative_reviews_campaign,\n    ISNULL(cic.interactions_campaign, 0) AS interactions_campaign,\n    ISNULL(cic.interactions_pre_campaign, 0) AS interactions_pre_campaign,\n    CASE\n        WHEN ISNULL(cic.interactions_campaign, 0) > ISNULL(cic.interactions_pre_campaign, 0) THEN 'Increased'\n        WHEN ISNULL(cic.interactions_campaign, 0) < ISNULL(cic.interactions_pre_campaign, 0) THEN 'Decreased'\n        WHEN ISNULL(cic.interactions_campaign, 0) = ISNULL(cic.interactions_pre_campaign, 0) THEN 'No Change'\n        ELSE 'N/A' -- Fallback, though with ISNULL, this path should ideally not be reached\n    END AS interaction_trend\nFROM\n    CampaignPeriods AS cp\nLEFT JOIN\n    CampaignTransactionStats AS cts ON cp.campaign_id = cts.campaign_id\nLEFT JOIN\n    CampaignTicketCounts AS ctc ON cp.campaign_id = ctc.campaign_id\nLEFT JOIN\n    CampaignReviewCounts AS crc ON cp.campaign_id = crc.campaign_id\nLEFT JOIN\n    CampaignInteractionCounts AS cic ON cp.campaign_id = cic.campaign_id\nORDER BY\n    cp.start_date;"
  }
]